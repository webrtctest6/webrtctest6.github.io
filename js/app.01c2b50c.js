(function(){"use strict";var t={3126:function(t,e,i){var s=i(6369),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},a=[],o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"login"}},[e("div",{attrs:{id:"top"}},[e("ul",{staticClass:"roomName"},[t._v(" 房间号: "),t._l(t.roomList,(function(i){return e("li",{key:i},[t._v(t._s(i))])}))],2)]),e("div",{attrs:{id:"main"}},[e("div",{attrs:{id:"form"}},[e("div",[e("span",{staticClass:"form"},[t._v("用户:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.userName,expression:"userName"}],staticClass:"form",attrs:{type:"text",id:"user"},domProps:{value:t.userName},on:{input:function(e){e.target.composing||(t.userName=e.target.value)}}})]),e("div",[e("span",{staticClass:"form"},[t._v("房间:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.roomNumber,expression:"roomNumber"}],staticClass:"form",attrs:{type:"text",id:"room"},domProps:{value:t.roomNumber},on:{input:[function(e){e.target.composing||(t.roomNumber=e.target.value)},t.limitRoom]}})])])]),e("div",{attrs:{id:"buttom"}},[e("button",{on:{click:t.addRoom}},[t._v("加入房间")])])])},n=[],c=(i(560),i(4488)),d={name:"login",data(){return{userName:"",roomNumber:"",socket:"",roomList:[]}},methods:{limitRoom(){let t=this.roomNumber.match(/[0-9]/g);t=t?t.splice(0,3):t;let e=t?t.join(""):t;this.roomNumber=e},addRoom(){if(!this.userName||!this.roomNumber)return;let t={userName:this.userName,roomName:this.roomNumber};this.socket.emit("joinRoom",t)}},created(){this.socket=(0,c.ZP)("https://webrtc.seele-exzzz.xyz:443")},mounted(){this.socket.on("addNewRoom",(t=>{this.roomList.push(t)})),this.socket.on("getRoomList",(t=>{this.roomList=t})),this.socket.on("fullRoom",(t=>{alert(t)})),this.socket.on("joinInRoom",((t,e)=>{sessionStorage.setItem("room",this.roomNumber),sessionStorage.setItem("user",this.userName),this.$router.push({name:"room"})}))}},l=d,h=i(1001),m=(0,h.Z)(l,o,n,!1,null,"8534b288",null),u=m.exports,p=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"main"}},[e("div",{attrs:{id:"left"}},[e("div",{attrs:{id:"videoDiv"}},[e("canvas",{attrs:{id:"canvas"}}),e("canvas",{staticStyle:{display:"none"},attrs:{id:"screenShotCanvas"}}),e("video",{attrs:{id:"remote"}}),e("video",{attrs:{id:"local"}}),e("video",{directives:[{name:"show",rawName:"v-show",value:t.showRecordVideo,expression:"showRecordVideo"}],attrs:{id:"recordVideo",autoplay:"true",controls:"true"}})]),e("div",{attrs:{id:"videoButton"}},[e("el-button",{staticClass:"button",attrs:{type:"primary",disabled:t.disabledList[0]},on:{click:function(e){return t.getStream(0,"camera")}}},[t._v("获取摄像头媒体流")]),e("el-button",{staticClass:"button",attrs:{type:"primary",disabled:t.disabledList[1]},on:{click:function(e){return t.getStream(1,"desktop")}}},[t._v("获取桌面媒体流")]),e("el-button",{staticClass:"button",attrs:{type:"primary",title:"获取远端屏幕截图"},on:{click:t.screenShot}},[t._v("获取屏幕截图")]),e("el-button",{staticClass:"button",attrs:{type:"primary",title:"录制远端视频"},on:{click:t.recordVideo}},[t._v("录制视频")]),e("el-button",{staticClass:"button",attrs:{type:"primary",title:"停止录制远端视频"},on:{click:t.stopRecordVideo}},[t._v("停止录制")]),e("el-button",{staticClass:"button",attrs:{type:"primary",title:"下载录制视频"},on:{click:t.downloadRecordVideo}},[t._v("下载录制视频")])],1)]),e("div",{attrs:{id:"right"}},[e("chat")],1)])},g=[],v=(i(8858),i(1318),i(3228),function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"chat"}},[e("div",{attrs:{id:"roomAndUser"}},[e("div",{staticClass:"roomAndUser"},[t._v(" 房间号:"+t._s(t.room)+" ")]),e("div",{staticClass:"roomAndUser"},[t._v(" 用户:"+t._s(t.user)+","+t._s(t.otherUser)+" ")])]),e("div",{attrs:{id:"chatContent"},on:{dragover:t.fileEnter,drop:t.fileLeave}},t._l(t.chatMsgList,(function(i){return e("div",{staticClass:"chatMsgDiv"},["get"===i.msgType?e("div",{attrs:{id:"leftMsg"}},[e("div",{attrs:{id:"leftAvatar"}},[e("img",{staticStyle:{margin:"5px"},attrs:{src:i.avatarURL}})]),e("div",{attrs:{id:"leftMsgContent"}},[e("div",{staticStyle:{height:"20px"}},[e("span",[t._v(t._s(i.user))])]),i.msg?[e("div",{attrs:{id:"leftUserMsg"}},t._l(i.msg,(function(i){return e("p",[t._v(" "+t._s(i)+" ")])})),0)]:t._e(),i.file?[e("div",{attrs:{id:"leftUserFile",id:t.msg,"+msgObj.file.timestamp":""}},[e("div",{staticStyle:{width:"160px",height:"65px"}},[e("div",{staticStyle:{width:"160px",height:"20px",margin:"2px"}},[t._v(" 文件名:"+t._s(i.file.name)+" ")]),e("div",{staticStyle:{width:"160px",height:"20px",margin:"2px"}},[t._v(" 文件大小:"+t._s(i.file.size)+" ")]),e("div",{staticStyle:{width:"160px",height:"20px",margin:"2px"}},[e("span",{attrs:{id:"_"+i.file.timestamp}},[t._v("上传进度:0")])])])])]:t._e(),i.img?[e("div",{attrs:{id:"leftUserImg"}},[e("img",{staticStyle:{width:"100px",height:"100px"},attrs:{id:"_"+i.img.timestamp,src:"",alt:""}})])]:t._e()],2)]):t._e(),"send"===i.msgType?e("div",{attrs:{id:"rightMsg"}},[e("div",{attrs:{id:"rightAvatar"}},[e("img",{staticStyle:{margin:"5px"},attrs:{src:i.avatarURL}})]),e("div",{attrs:{id:"rightMsgContent"}},[e("div",{staticStyle:{height:"20px",float:"right"},attrs:{id:"rightChatUserName"}},[e("span",[t._v(t._s(i.user))])]),i.msg?[e("div",{attrs:{id:"rightUserMsg"}},t._l(i.msg,(function(i){return e("p",[t._v(" "+t._s(i)+" ")])})),0)]:t._e(),i.file?[e("div",{attrs:{id:"rightUserFile"}},[e("div",{staticStyle:{width:"160px",height:"65px"}},[e("div",{staticStyle:{width:"160px",height:"20px",margin:"2px"}},[t._v(" 文件名:"+t._s(i.file.name)+" ")]),e("div",{staticStyle:{width:"160px",height:"20px",margin:"2px"}},[t._v(" 文件大小:"+t._s(i.file.size)+" ")]),e("div",{staticStyle:{width:"160px",height:"20px",margin:"2px"}},[e("span",{attrs:{id:"_"+i.file.timestamp}},[t._v("上传进度:0")])])])])]:t._e(),i.img?[e("div",{attrs:{id:"rightUserImg"}},[e("img",{staticStyle:{width:"100px",height:"100px"},attrs:{id:"_"+i.img.timestamp,src:"",alt:""}})])]:t._e()],2)]):t._e()])})),0),e("div",{attrs:{id:"send"}},[t.showEmoji?e("div",{attrs:{id:"emojiBox"},on:{click:t.clickEmoji}},t._l(t.emojiList,(function(i){return e("div",{staticStyle:{width:"30px",height:"30px"}},[e("div",{staticStyle:{width:"24px",height:"24px",margin:"3px"},domProps:{innerHTML:t._s(i)}})])})),0):t._e(),e("div",{attrs:{id:"sendButton"}},[e("ul",[e("li",{staticClass:"iconBox",attrs:{title:"创建头像"},on:{click:t.createAvatar}},[e("svg",{staticClass:"icon",attrs:{t:"1701659913144",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7056",width:"200",height:"200"}},[e("path",{attrs:{d:"M512 42.666667a469.333333 469.333333 0 1 0 469.333333 469.333333A469.333333 469.333333 0 0 0 512 42.666667z m0 896a424.533333 424.533333 0 0 1-279.466667-104.96 298.666667 298.666667 0 0 1 558.933334 0A424.533333 424.533333 0 0 1 512 938.666667z m-149.333333-490.666667a149.333333 149.333333 0 1 1 149.333333 149.333333 149.333333 149.333333 0 0 1-149.333333-149.333333z m461.866666 353.493333a341.333333 341.333333 0 0 0-213.333333-189.226666 192 192 0 1 0-197.973333 0 341.333333 341.333333 0 0 0-213.333334 189.226666 426.666667 426.666667 0 1 1 624.64 0z",fill:"#666666","p-id":"7057"}})])]),e("li",{staticClass:"iconBox",attrs:{title:"表情包"},on:{click:t.emoji}},[e("svg",{staticClass:"icon",attrs:{t:"1701658883145",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"26849",width:"200",height:"200"}},[e("path",{attrs:{d:"M512 512m-393.846154 0a393.846154 393.846154 0 1 0 787.692308 0 393.846154 393.846154 0 1 0-787.692308 0Z",fill:"#BFBFBF","p-id":"26850"}}),e("path",{attrs:{d:"M469.464615 469.464615m-351.310769 0a351.310769 351.310769 0 1 0 702.621539 0 351.310769 351.310769 0 1 0-702.621539 0Z",fill:"#FFFFFF","p-id":"26851"}}),e("path",{attrs:{d:"M354.461538 615.975385a100.036923 78.769231 90 1 0 157.538462 0 100.036923 78.769231 90 1 0-157.538462 0Z",fill:"#808080","p-id":"26852"}}),e("path",{attrs:{d:"M352.098462 335.556923m-59.076924 0a59.076923 59.076923 0 1 0 118.153847 0 59.076923 59.076923 0 1 0-118.153847 0Z",fill:"#808080","p-id":"26853"}}),e("path",{attrs:{d:"M623.852308 372.578462m-59.076923 0a59.076923 59.076923 0 1 0 118.153846 0 59.076923 59.076923 0 1 0-118.153846 0Z",fill:"#808080","p-id":"26854"}}),e("path",{attrs:{d:"M512 937.353846c-234.732308 0-425.353846-190.621538-425.353846-425.353846s190.621538-425.353846 425.353846-425.353846 425.353846 190.621538 425.353846 425.353846-190.621538 425.353846-425.353846 425.353846z m0-787.692308c-200.073846 0-362.338462 162.264615-362.338462 362.338462s162.264615 362.338462 362.338462 362.338462 362.338462-162.264615 362.338462-362.338462-162.264615-362.338462-362.338462-362.338462z",fill:"#7F7F7F","p-id":"26855"}})])]),e("li",{staticClass:"iconBox",attrs:{title:"发送图片"},on:{click:t.sendImage}},[e("svg",{staticClass:"icon",attrs:{t:"1701658645047",viewBox:"0 0 1027 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6148",width:"200",height:"200"}},[e("path",{attrs:{d:"M920.122141 75.836199l-820.906465 0c-50.327222 0-91.27175 40.944528-91.27175 91.27175l0 692.00877c0 50.328245 40.944528 91.27175 91.27175 91.27175l820.906465 0c50.327222 0 91.270726-40.944528 91.270726-91.27175L1011.392868 167.107949C1011.393891 116.780727 970.449363 75.836199 920.122141 75.836199zM99.215676 142.351102l820.906465 0c13.650905 0 24.755824 11.105942 24.755824 24.756847l0 492.720911c-46.914496-72.336492-110.60712-166.954453-145.379065-203.557092-29.553083-31.108508-59.966767-37.638225-80.276325-37.638225-0.00307 0 0.002047 0-0.001023 0-44.896536 0-77.273944 30.226418-83.743286 36.759205-13.08297 12.219299-179.912579 168.045297-200.162786 187.432857-10.619872-11.965519-49.051159-54.918797-86.132706-92.001367-23.834848-23.835871-54.854329-31.725562-87.346347-22.215978-21.236674 6.216585-35.982516 17.84339-38.721907 20.111037l-0.25992 0.214894L74.458829 676.898631l0-509.790682C74.458829 153.457044 85.564771 142.351102 99.215676 142.351102zM920.122141 883.873566l-820.906465 0c-13.650905 0-24.756847-11.106965-24.756847-24.756847l0-92.362594L265.490653 599.998193c2.296299-1.743714 8.968256-6.03546 16.266475-7.891737 8.400321-2.134617 14.120602-0.523933 20.392446 5.749958 39.07904 39.080064 81.20651 86.614683 85.658915 91.651396 4.513804 5.417383 19.348674 20.85805 42.86732 22.494317 12.373819 0.86367 31.051203-1.956561 49.753147-20.276812 9.15859-8.972349 148.204413-138.926096 201.00906-188.242292l0.531096-0.437975 0.800225-0.873903c4.881171-4.882194 20.48352-17.021675 36.46347-17.021675 0.099261 0 0.199545 0 0.298805 0.001023 10.633175 0.101307 21.017686 5.640464 31.746028 16.933671 39.418778 41.494043 146.583496 195.563024 193.60237 267.566942l0 89.465614C944.878988 872.767624 933.773046 883.873566 920.122141 883.873566z",fill:"#4C4C4C","p-id":"6149"}}),e("path",{attrs:{d:"M275.135314 442.432575c52.972469 0 96.067986-43.096541 96.067986-96.067986s-43.095517-96.067986-96.067986-96.067986-96.067986 43.095517-96.067986 96.067986S222.162846 442.432575 275.135314 442.432575zM275.135314 316.810482c16.295128 0 29.553083 13.257955 29.553083 29.553083 0 16.296151-13.257955 29.553083-29.553083 29.553083s-29.553083-13.257955-29.553083-29.553083C245.582231 330.068438 258.840186 316.810482 275.135314 316.810482z",fill:"#4C4C4C","p-id":"6150"}})])]),e("li",{staticClass:"iconBox",attrs:{title:"发送文件"},on:{click:t.sendFile}},[e("svg",{staticClass:"icon",attrs:{t:"1701659527057",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"31921",width:"200",height:"200"}},[e("path",{attrs:{d:"M357.285 86c41.5 0 77.11 25.2 92.347 61.126V143.5h260.02c81.791 0 148.269 65.52 149.59 146.87l0.02 2.47 0.002 6.747C898.87 319.726 926 360.847 926 408.301V803.6c0 73.675-59.759 133.4-133.475 133.4h-619.05C99.76 937 40 877.275 40 803.6V224c0-76.215 61.82-138 138.078-138h179.207z m0.759 59.8H178.078c-42.781 0-77.543 34.315-78.234 76.907l-0.01 1.293v579.6c0 40.242 32.314 72.94 72.424 73.59l1.217 0.01h619.05c40.264 0 72.981-32.296 73.631-72.383l0.01-1.217V408.3c0-33.953-27.265-61.542-61.107-62.09l-1.028-0.01H554.196c-85.562 0-155.085-68.628-156.467-153.813l-0.021-2.586v-3.6c0-22.06-17.69-39.99-39.664-40.401z m155.332 301.584c13.827-13.623 36.03-13.623 49.858 0l141.784 139.693 0.387 0.388c6.526 6.633 9.828 15.263 9.892 23.917v0.845c-0.065 8.824-3.497 17.623-10.28 24.306L563.235 776.225c-13.828 13.624-36.03 13.624-49.858 0a34.49 34.49 0 0 1-0.363-0.362c-13.364-13.565-13.202-35.396 0.363-48.76l89.258-87.941h-320.23c-16.523 0-29.917-13.395-29.917-29.917 0-16.523 13.394-29.917 29.917-29.917h315.033l-84.061-82.821-0.403-0.403c-13.164-13.398-13.19-34.928 0.04-48.357 0.12-0.122 0.241-0.243 0.363-0.363zM709.653 203.3l-251.175 0.001c6.57 46.96 46.921 83.1 95.718 83.1H799.2c-3.275-45.952-41.319-82.333-88.062-83.089l-1.485-0.012z",fill:"#333333","p-id":"31922"}})])])])]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.chatMsg,expression:"chatMsg"}],attrs:{id:"sendTextarea",spellcheck:"false"},domProps:{value:t.chatMsg},on:{keyup:t.sendMsgEnter,input:function(e){e.target.composing||(t.chatMsg=e.target.value)}}}),e("el-button",{attrs:{type:"success",id:"sendMsg"},on:{click:t.sendMsg}},[t._v("发送")])],1),e("canvas",{staticStyle:{display:"none"},attrs:{id:"avatar"}})])}),f=[];i(4224),i(1121),i(7133);let w=new Map,y=new Map,x=new Map;class b{constructor({msg:t,user:e,avatarURL:i,file:s,msgType:r,img:a}){this.msgType=r,this.msg=t,this.user=e,this.avatarURL=i,this.file=s||"",this.img=a||""}}var M={data(){return{socket:"",chatMsg:"",chatMsgList:[],room:"",user:"",otherUser:"",avatarURL:"",emojiList:["&#x1F600","&#x1F604","&#x2764","&#x1F602","&#x1F44F","&#x1F3A7","&#x1F60D","&#x1F4AA","&#x1F4B0","&#x1F618"],showEmoji:!1}},methods:{fileEnter(t){t.preventDefault(),t.target.style.backgroundColor="rgba(100,100,100,0.2)"},fileLeave(t){t.preventDefault(),t.target.style.backgroundColor="#f5f5f5";let e=t.dataTransfer.files[0];this.fileSlice(e)},async createAvatar(){let t=await this.getFile(),e=new FileReader;e.readAsDataURL(t),e.onload=t=>{let e=t.target.result,i=new Image;i.src=e,i.onload=()=>{let t=document.querySelector("#avatar"),e=t.getContext("2d");t.width=40,t.height=40,e.drawImage(i,0,0,t.width,t.height),this.avatarURL=t.toDataURL(),localStorage.setItem("avatar",this.avatarURL),e.clearRect(0,0,t.width,t.height)}}},emoji(){this.showEmoji=!this.showEmoji},clickEmoji(t){this.chatMsg+=t.target.innerHTML},async sendImage(){let t=await this.getFile({type:[{accept:{"image/*":[".jpg",".jpeg",".png",".gif",".bmp"]}}]});this.imageSlice(t)},async sendFile(){let t=await this.getFile();this.fileSlice(t)},imageSlice(t){let e=Date.now(),i=t.name,s=t.type,r=new b({msgType:"send",user:this.user,avatarURL:this.avatarURL,img:{name:i,type:s,timestamp:e}});this.chatMsgList.push(r);let a=new FileReader,o=new FileReader;a.readAsDataURL(t),o.readAsArrayBuffer(t),a.onload=t=>{let i=document.querySelector(`#_${e}`);i.src=t.target.result},o.onload=i=>{let s=i.target.result,a=t.type,o=t.name,n=512e3,c=Math.ceil(t.size/n),d=t.size,l=0,h=0;this.socket.emit("uploadImageStart",e,c,t.size,this.room,r);while(l<d){let t=s.slice(l,l+n);this.socket.emit("uploadImage",t,h,this.room,c,e,a,o,d),l+=n,h++}}},fileSlice(t){let e;e=t.size<1024?t.size+"B":t.size<1048576?(t.size/1024).toFixed(2)+"KB":t.size<1073741824?(t.size/1048576).toFixed(2)+"MB":(t.size/1073741824).toFixed(2)+"GB";let i=Date.now(),s=t.type,r=t.name.length>6?t.name.slice(0,6)+"...":t.name,a=new FileReader,o=new b({msgType:"send",msg:!1,user:this.user,avatarURL:this.avatarURL,file:{name:r,type:s,size:e,timestamp:i}}),n=512e3,c=Math.ceil(t.size/n);this.socket.emit("uploadFileStart",i,c,t.size,this.room,o),this.chatMsgList.push(o),a.readAsArrayBuffer(t),a.onload=e=>{let s=e.target.result,a=s.byteLength,o=0,d=0;while(o<a){let e=s.slice(o,o+n);this.socket.emit("uploadFile",e,d,this.room,c,i,t.type,r,t.size),o+=n,d++}}},makeText(t){let e=document.querySelector("#avatar"),i=e.getContext("2d");i.font="16px Arial";let s=t.split("\n"),r=[],a="",o=0;for(let n=0;n<s.length;n++){for(let t=0;t<s[n].length;t++)a+=s[n][t],o=i.measureText(a).width,o>200&&(a.slice(a.length-1),r.push(a),a=s[n][t]);r.push(a),a=""}return r},sendMsgEnter(t){13===t.keyCode&&this.sendMsg()},sendMsg(){let t=this.makeText(this.chatMsg);this.chatMsg=t;let e=new b({msgType:"send",msg:this.chatMsg,user:this.user,avatarURL:this.avatarURL});this.chatMsgList.push(e),this.socket.emit("sendChatMsg",e,this.room),this.chatMsg=""},async getFile(t){try{let e=await showOpenFilePicker(t),i=await e[0].getFile();return i}catch{}}},created(){this.socket=(0,c.ZP)("https://webrtc.seele-exzzz.xyz:443")},mounted(){this.user=sessionStorage.getItem("user"),this.room=sessionStorage.getItem("room"),this.avatarURL=localStorage.getItem("avatar"),this.socket.on("getChat",(t=>{this.chatMsgList.push(t)})),this.socket.emit("getOtherUser",this.room,this.user),this.socket.on("otherUserJoinInRoom",(t=>{this.otherUser=t})),this.socket.on("uploadFileSliceIndex",((t,e,i,s)=>{let r=document.querySelector(`#_${s}`),a=w.get(s)||[];a.push(t),w.set(s,a);let o=(a.length/e).toFixed(2);a.length<e?r.innerHTML=`上传进度:${o}`:(r.innerHTML="上传成功",w.clear(s))})),this.socket.on("sendImage",((t,e,i,s,r,a,o)=>{let n=x.get(s)||[];if(n.push({arrayBuffer:t,index:e}),x.set(s,n),n.length===i){let t=document.querySelector(`#_${s}`);n.sort(((t,e)=>{t.index,e.index}));let e=new ArrayBuffer(o),i=new Uint8Array(e),a=0;for(let s=0;s<n.length;s++){let t=new Uint8Array(n[s].arrayBuffer);i.set(t,a),a+=n[s].arrayBuffer.byteLength}let c=new Blob([e],{type:r}),d=new FileReader;d.readAsDataURL(c),d.onload=e=>{let i=e.target.result;t.src=i,x.delete(s)}}})),this.socket.on("sendFile",((t,e,i,s,r,a,o)=>{let n=document.querySelector(`#_${s}`),c=y.get(s)||[];c.push({arrayBuffer:t,index:e}),y.set(s,c);let d=(c.length/i).toFixed(2);if(c.length<i)n.innerHTML=`上传进度:${d}`;else{let t=document.createElement("a");t.download=!0,c.sort(((t,e)=>{t.index,e.index}));let e=new ArrayBuffer(o),i=new Uint8Array(e),a=0;for(let s=0;s<c.length;s++){let t=new Uint8Array(c[s].arrayBuffer);i.set(t,a),a+=c[s].arrayBuffer.byteLength}let d=new Blob([e],{type:r}),l=new FileReader;l.readAsDataURL(d),l.onload=e=>{let i=e.target.result;t.href=i;let r=document.querySelector(`#msg${s}`);r.addEventListener("click",(()=>{t.click()}))},n.innerHTML="点击下载",y.clear(s)}})),this.socket.on("sendImageStart",((t,e,i,s)=>{this.chatMsgList.push(s)})),this.socket.on("sendFileStart",((t,e,i,s)=>{this.chatMsgList.push(s)})),this.socket.emit("userjoinRoom",this.room)}},S=M,k=(0,h.Z)(S,v,f,!1,null,"3b772bdd",null),L=k.exports,_={components:{chat:L},data(){return{record:"",recordLive:!1,user:"",room:"",socket:"",stream:"",remoteStream:"",user:"",userType:"",pc:"",candidate:"",disabledList:[!1,!1,!1,!1],live:!1,recordBlobList:[],recordVideoMove:!1,recordVideoMouseX:"",recordVideoMouseY:"",recordVideoLeft:"",recordVideoTop:"",sourceBuffer:"",showRecordVideo:!1}},methods:{async getFirstPostion(t){if(t.preventDefault(),this.recordVideoMove)return;this.recordVideoMove=!0;let e=await t.target.getBoundingClientRect().left,i=await t.target.getBoundingClientRect().top;this.recordVideoLeft=e,this.recordVideoTop=i,this.recordVideoMouseX=t.clientX,this.recordVideoMouseY=t.clientY},getMovePostion(t){t.preventDefault(),this.recordVideoMove&&(t.target.style.left=this.recordVideoLeft+t.clientX-this.recordVideoMouseX+"px",t.target.style.top=this.recordVideoTop+t.clientY-this.recordVideoMouseY+"px")},getLastPostion(t){t.preventDefault(),this.recordVideoMove&&(this.recordVideoMove=!1)},async getStream(t,e){"camera"===e?this.stream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}):"desktop"===e&&(this.stream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}));let i=document.querySelector("#local");if(i.srcObject=this.stream,i.oncanplay=()=>{i.play()},this.pc){const t=this.pc.getSenders();t.forEach((t=>{"video"===t.track.kind?t.replaceTrack(this.stream.getVideoTracks()[0]):"audio"===t.track.kind&&t.replaceTrack(this.stream.getAudioTracks()[0])}))}else this.pc=new RTCPeerConnection,await this.pc.addStream(this.stream);this.userType||(this.socket.emit("getOfferRoom",this.room),this.socket.on("getUserType",(async(t,e)=>{this.userType=t,"send"===t?this.localConnection():"get"===t&&this.remoteConnection(e)}))),this.pc.onicecandidate=t=>{t.candidate&&this.socket.emit("candidate",t.candidate,this.room,this.userType)},this.pc.ontrack=async t=>{let e=document.querySelector("#remote");e.srcObject=await t.streams[0],e.oncanplay=()=>{e.play()},this.live=!0},this.disabledList=this.disabledList.map(((e,i)=>i==t))},async mediaConsultation(){},async localConnection(){this.userType="send";let t=await this.pc.createOffer();return await this.pc.setLocalDescription(t),this.socket.emit("sendOffer",t,this.room),this.socket.on("getAnswer",(async t=>{await this.pc.setRemoteDescription(t),this.pc.addIceCandidate(this.candidate)})),t},async remoteConnection(t){this.userType="get",await this.pc.setRemoteDescription(t);let e=await this.pc.createAnswer();await this.pc.setLocalDescription(e),this.socket.emit("sendAnswer",e,this.room),this.pc.addIceCandidate(this.candidate)},screenShot(){if(!this.live)return;let t=document.querySelector("#screenShotCanvas"),e=t.getContext("2d"),i=document.querySelector("#remote");t.width=i.videoWidth,t.height=i.videoHeight,e.drawImage(i,0,0,t.width,t.height),t.toBlob((t=>{navigator.clipboard.write([new ClipboardItem({"image/png":t})]).then((()=>{})).catch((t=>console.log(t)))}))},async recordVideo(){if(this.recordLive)return;this.showRecordVideo=!0;const t={mimeType:"video/webm;codecs=vp8",audioBitsPerSecond:128e3,videoBitsPerSecond:25e5};let e=document.querySelector("#remote");this.remoteStream=await e.captureStream();let i=document.querySelector("#recordVideo"),s=new MediaRecorder(this.remoteStream,t);this.record=s,this.recordLive=!0,s.start(1e3);let r,a=new MediaSource;i.src=URL.createObjectURL(a),a.addEventListener("sourceopen",(()=>{const t='video/webm;codecs="vp8",opus';r=a.addSourceBuffer(t)})),s.ondataavailable=t=>{const e=t.data;if(this.recordBlobList.push(t.data),e.size>0){const t=new FileReader;t.readAsArrayBuffer(e),t.onloadend=t=>{r.appendBuffer(t.target.result)}}}},stopRecordVideo(){this.record&&(this.record.stop(),this.showRecordVideo=!1)},downloadRecordVideo(){if(!this.recordBlobList)return;let t=document.createElement("a"),e=new Blob(this.recordBlobList,{type:"video/mp4"}),i=new FileReader;t.download=!0,i.readAsDataURL(e),i.onload=e=>{let i=e.target.result;t.href=i,t.click()}}},created(){this.socket=(0,c.ZP)("https://webrtc.seele-exzzz.xyz:443"),sessionStorage.getItem("user")&&sessionStorage.getItem("room")&&(this.user=sessionStorage.getItem("user"),this.room=sessionStorage.getItem("room"))},mounted(){sessionStorage.getItem("user")&&sessionStorage.getItem("room")&&(this.user=sessionStorage.getItem("user"),this.room=sessionStorage.getItem("room")),this.socket.on("getCandidate",((t,e)=>{this.candidate=t})),this.socket.emit("userjoinRoom",this.room)}},C=_,R=(0,h.Z)(C,p,g,!1,null,"a2ce6ce8",null),F=R.exports,B={data(){return{page:"/"}},components:{login:u,room:F}},z=B,U=(0,h.Z)(z,r,a,!1,null,null,null),T=U.exports,V=i(2631);s["default"].use(V.ZP);const A=[{path:"/",name:"login",component:u},{path:"/room",name:"room",component:F}],I=new V.ZP({mode:"history",base:"/",routes:A});var j=I,N=i(8499),D=i.n(N);s["default"].use(D()),s["default"].config.productionTip=!1,new s["default"]({router:j,render:t=>t(T)}).$mount("#app")}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var a=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=t,function(){i.amdO={}}(),function(){var t=[];i.O=function(e,s,r,a){if(!s){var o=1/0;for(l=0;l<t.length;l++){s=t[l][0],r=t[l][1],a=t[l][2];for(var n=!0,c=0;c<s.length;c++)(!1&a||o>=a)&&Object.keys(i.O).every((function(t){return i.O[t](s[c])}))?s.splice(c--,1):(n=!1,a<o&&(o=a));if(n){t.splice(l--,1);var d=r();void 0!==d&&(e=d)}}return e}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[s,r,a]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var r,a,o=s[0],n=s[1],c=s[2],d=0;if(o.some((function(e){return 0!==t[e]}))){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(c)var l=c(i)}for(e&&e(s);d<o.length;d++)a=o[d],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return i.O(l)},s=self["webpackChunkwebrtc"]=self["webpackChunkwebrtc"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(3126)}));s=i.O(s)})();
//# sourceMappingURL=app.01c2b50c.js.map